!function(){"use strict";var t=function(){var t=this;t._options={sampleRate:16e3,bufferSize:4096},"string"==typeof arguments[0]&&t._assignOptions(arguments[1]),"string"!=typeof arguments[0]&&t._assignOptions(arguments[0])};t.prototype._init=function(t){var e=this;e._ctx=null,e._pause=!1,e._stream=null,e._audioInputNode=null,e._processNode=null,e._PCM32fSamplesNoFlat=[],e._PCM16iDataView=null,e._PCM32fSamples=null,e._PCM16iSamples=null,e._setupAudioContext()},t.prototype._assignOptions=function(t){t&&Object.assign(this._options,t)},t.prototype.setOptions=function(t){t&&Object.assign(this._options,t)},t.prototype.start=function(){this._init()},t.prototype.pause=function(){this._pause||(this._pause=!0)},t.prototype.resume=function(){this._pause&&(this._pause=!1)},t.prototype.stop=function(){var t=this;t._pause||(t._audioInputNode&&t._audioInputNode.disconnect(),t._processNode&&t._processNode.disconnect(),t._ctx&&t._ctx.close(),t._stream&&t._stream.getTracks&&(t._stream.getTracks().forEach((t=>t.stop())),t._stream=null),t._pause=!0,t._flatPCM32fSamples(),t._convertPCM32f2PCM16i(),t._convertPCM16i2WAV())},t.prototype.play=function(){var t=this;if(t.stop(),t._PCM16iDataView){var e=new AudioContext;e.decodeAudioData(t._PCM16iDataView.buffer,(t=>{var o=e.createBufferSource();o.buffer=t,o.connect(e.destination),o.start(0),o.onended=()=>{o.disconnect(e.destination)}}))}},t.prototype.exportWAV=function(){return this.stop(),this._PCM16iDataView.buffer},t.prototype.download=function(){var t=document.createElement("a");t.style="display: none",t.innerHTML="download",t.download="audio.wav",t.href=URL.createObjectURL(new Blob([this.exportWAV()],{type:"audio/wav"})),document.body.appendChild(t),t.click(),document.body.removeChild(t)},t.prototype._convertPCM16i2WAV=function(){var t=this,e=2*t._options.sampleRate,o=2*t._PCM16iSamples.length,n=new ArrayBuffer(44+o);DataView.prototype.setString=function(t,e){for(var o=0;o<e.length;o++)this.setUint8(t+o,e.charCodeAt(o))},DataView.prototype.setData=function(t,e){for(var o=0;o<e.length;o++,t+=2)this.setInt16(t,e[o],!0)};var a=new DataView(n);a.setString(0,"RIFF"),a.setUint32(4,36+o,!0),a.setString(8,"WAVE"),a.setString(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,t._options.sampleRate,!0),a.setUint32(28,e,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),a.setString(36,"data"),a.setUint32(40,o,!0),a.setData(44,t._PCM16iSamples),t._PCM16iDataView=a},t.prototype._convertPCM32f2PCM16i=function(){var t=this;t._PCM16iSamples=new Int16Array(t._PCM32fSamples.length);for(var e=0;e<t._PCM32fSamples.length;e++){var o=Math.max(-1,Math.min(1,t._PCM32fSamples[e]));o=o<0?32768*o:32767*o,t._PCM16iSamples[e]=o}},t.prototype._flatPCM32fSamples=function(){var t=this;t._PCM32fSamples=new Float32Array(t._PCM32fSamplesNoFlat.length*t._options.bufferSize);for(let e=0;e<t._PCM32fSamplesNoFlat.length;e++)t._PCM32fSamples.set(t._PCM32fSamplesNoFlat[e],t._options.bufferSize*e)},t.prototype._setupAudioContext=function(){var t=this;navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{t._stream=e,t._ctx=new AudioContext({sampleRate:t._options.sampleRate}),t._audioInputNode=t._ctx.createMediaStreamSource(e),t._processNode=t._audioInputNode.context.createScriptProcessor(t._options.bufferSize),t._processNode.onaudioprocess=e=>{t._pause||t._PCM32fSamplesNoFlat.push(new Float32Array(e.inputBuffer.getChannelData(0)))},t._audioInputNode.connect(t._processNode),t._processNode.connect(t._ctx.destination)}))},"undefined"!=typeof exports&&(exports.Tacus=t),"undefined"!=typeof global?global.Tacus=t:"undefined"!=typeof window&&(window.Tacus=t)}();
